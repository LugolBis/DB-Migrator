{
    "tables":[
       {
          "table_name":"auteurs",
          "columns":[
             {
                "column_name":"auteur_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('auteurs_auteur_id_seq'::regclass)"
             },
             {
                "column_name":"nom",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"nationalite",
                "data_type":"character varying",
                "is_nullable":"YES",
                "column_default":null
             }
          ],
          "foreign_keys":null
       },
       {
          "table_name":"livres",
          "columns":[
             {
                "column_name":"livre_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('livres_livre_id_seq'::regclass)"
             },
             {
                "column_name":"titre",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"auteur_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"date_publication",
                "data_type":"date",
                "is_nullable":"YES",
                "column_default":null
             },
             {
                "column_name":"isbn",
                "data_type":"character varying",
                "is_nullable":"YES",
                "column_default":null
             },
             {
                "column_name":"categorie_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"editeur_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":null
             }
          ],
          "foreign_keys":[
             {
                "constraint_name":"livres_auteur_id_fkey",
                "column_name":"auteur_id",
                "referenced_table":"auteurs",
                "referenced_column":"auteur_id"
             },
             {
                "constraint_name":"livres_categorie_id_fkey",
                "column_name":"categorie_id",
                "referenced_table":"categories",
                "referenced_column":"categorie_id"
             },
             {
                "constraint_name":"livres_editeur_id_fkey",
                "column_name":"editeur_id",
                "referenced_table":"editeurs",
                "referenced_column":"editeur_id"
             }
          ]
       },
       {
          "table_name":"categories",
          "columns":[
             {
                "column_name":"categorie_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('categories_categorie_id_seq'::regclass)"
             },
             {
                "column_name":"nom",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             }
          ],
          "foreign_keys":null
       },
       {
          "table_name":"editeurs",
          "columns":[
             {
                "column_name":"editeur_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('editeurs_editeur_id_seq'::regclass)"
             },
             {
                "column_name":"nom",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"adresse",
                "data_type":"character varying",
                "is_nullable":"YES",
                "column_default":null
             }
          ],
          "foreign_keys":null
       },
       {
          "table_name":"exemplaires",
          "columns":[
             {
                "column_name":"exemplaire_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('exemplaires_exemplaire_id_seq'::regclass)"
             },
             {
                "column_name":"livre_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"statut",
                "data_type":"character varying",
                "is_nullable":"YES",
                "column_default":null
             }
          ],
          "foreign_keys":[
             {
                "constraint_name":"exemplaires_livre_id_fkey",
                "column_name":"livre_id",
                "referenced_table":"livres",
                "referenced_column":"livre_id"
             }
          ]
       },
       {
          "table_name":"utilisateurs",
          "columns":[
             {
                "column_name":"utilisateur_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('utilisateurs_utilisateur_id_seq'::regclass)"
             },
             {
                "column_name":"prenom",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"nom",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"email",
                "data_type":"character varying",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"date_inscription",
                "data_type":"date",
                "is_nullable":"YES",
                "column_default":"CURRENT_DATE"
             }
          ],
          "foreign_keys":null
       },
       {
          "table_name":"emprunts",
          "columns":[
             {
                "column_name":"emprunt_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":"nextval('emprunts_emprunt_id_seq'::regclass)"
             },
             {
                "column_name":"utilisateur_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"exemplaire_id",
                "data_type":"integer",
                "is_nullable":"NO",
                "column_default":null
             },
             {
                "column_name":"date_emprunt",
                "data_type":"date",
                "is_nullable":"NO",
                "column_default":"CURRENT_DATE"
             },
             {
                "column_name":"date_retour",
                "data_type":"date",
                "is_nullable":"YES",
                "column_default":null
             }
          ],
          "foreign_keys":[
             {
                "constraint_name":"emprunts_utilisateur_id_fkey",
                "column_name":"utilisateur_id",
                "referenced_table":"utilisateurs",
                "referenced_column":"utilisateur_id"
             },
             {
                "constraint_name":"emprunts_exemplaire_id_fkey",
                "column_name":"exemplaire_id",
                "referenced_table":"exemplaires",
                "referenced_column":"exemplaire_id"
             }
          ]
       }
    ],
    "triggers":[
       {
          "trigger_name":"disponible",
          "event":"CREATE TRIGGER disponible BEFORE INSERT ON public.emprunts FOR EACH ROW EXECUTE FUNCTION verifier_disponibilite()",
          "table_name":"emprunts"
       }
    ],
    "procedures":[
       {
          "procedure_name":"retour",
          "return_type":"void",
          "arguments":null,
          "definition":"CREATE OR REPLACE PROCEDURE public.retour(IN exemplaire_id integer)\n LANGUAGE plpgsql\nAS $procedure$\nbegin\n    update exemplaires set statut=\"disponible\" where exemplaire_id=exemplaire_id;\nend;\n$procedure$\n"
       }
    ],
    "functions":[
       {
          "function_name":"verifier_disponibilite",
          "return_type":"trigger",
          "arguments":"trigger",
          "definition":"CREATE OR REPLACE FUNCTION public.verifier_disponibilite()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\ndeclare\n    DISPONIBILITE varchar(20);\nbegin\n    select statut into DISPONIBILITE\n    from exemplaires\n    where exemplaire_id = new.exemplaire_id;\n\n    if DISPONIBILITE = 'disponible' then\n        update exemplaires \n        set statut = 'emprunt\u00e9' \n        where exemplaire_id = new.exemplaire_id;\n    else\n        RAISE EXCEPTION 'The book % is already borrowed.', new.exemplaire_id;\n    end if;\n\n    return new;\nend;\n$function$\n"
       }
    ]
}